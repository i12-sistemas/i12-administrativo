(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{"9e27":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-page",{},[a("div",{staticClass:"row doc-header",class:e.$q.platform.is.mobile?"":"q-pa-lg"},[a("div",{staticClass:"col-12"},[e.error?a("div",{staticClass:"col-12"},[a("q-banner",{staticClass:"bg-negative text-white"},[e._v(e._s(e.error))])],1):e._e(),e.rows&&e.rows.length>0?a("q-card",{staticClass:"bg-white q-mt-md",attrs:{flat:"",bordered:!e.$q.platform.is.mobile,square:e.$q.platform.is.mobile}},[e.$q.platform.is.mobile?a("q-separator"):e._e(),a("q-card-section",{staticClass:"q-pa-none"},[a("div",{staticStyle:{"max-width":"100vw"}},[a("q-table",{attrs:{data:e.rows,columns:e.columns,dense:!e.$q.platform.is.mobile,flat:"",loading:e.loading,color:"primary",id:"sticky-table",pagination:e.dataset.pagination,"row-key":"filename","rows-per-page-options":[0]},on:{"update:pagination":function(t){return e.$set(e.dataset,"pagination",t)},request:e.refreshData},scopedSlots:e._u([{key:"body-cell-action",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("q-btn",{attrs:{flat:"",round:"",dense:!e.$q.platform.is.mobile,size:e.$q.platform.is.mobile?"12px":"8px",icon:"more_vert"},on:{click:function(a){return e.actEditDialog(t.pageIndex)}}},[a("q-tooltip",[e._v("Abrir coleta")])],1)],1)]}},{key:"body-cell-created_at",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("div",{staticClass:"cursor-pointer",on:{click:function(a){return e.actEditDialog(t.pageIndex)}}},[e._v("\n                        "+e._s(e.$helpers.datetimeRelativeToday(t.row.created_at))+"\n                        "),a("q-tooltip",[a("div",[e._v("Criado em "+e._s(e.$helpers.datetimeToBR(t.row.created_at)))]),a("div",[e._v("por "+e._s(t.row.usuario?t.row.usuario.nome:"?"))])])],1)])]}}],null,!1,3397670598)})],1)])],1):e._e(),a("q-page-sticky",{attrs:{position:"top",expand:""}},[a("q-toolbar",{staticClass:"bg-white text-primary shadow-up-21"},[a("q-btn",{attrs:{flat:"",dense:"",round:"","aria-label":"Menu",icon:"menu"},on:{click:function(t){return e.$store.dispatch("homedashboard/togglemenu")}}}),a("q-btn",{attrs:{flat:"",round:"",icon:"arrow_back"},on:{click:function(t){return e.$router.go(-1)}}}),e.$q.platform.is.mobile?e._e():a("q-separator",{attrs:{vertical:"",inset:"",spaced:""}}),a("q-toolbar-title",[e._v("Tabela IBPT")]),a("q-btn",{attrs:{icon:"work_history",label:e.$q.platform.is.mobile?"":"log",round:e.$q.platform.is.mobile,flat:"",to:{name:"tabelaibpt.log"}}}),a("q-btn",{attrs:{icon:"add",label:e.$q.platform.is.mobile?"":"Adicionar",round:e.$q.platform.is.mobile,flat:""},on:{click:e.actAdd}}),a("q-btn",{attrs:{icon:"sync",label:e.$q.platform.is.mobile?"":"Atualizar",round:e.$q.platform.is.mobile,flat:"",loading:e.loading},on:{click:function(t){return e.refreshData(null)}}})],1)],1)],1)])])],1)},r=[],o=a("a34a"),i=a.n(o),s=(a("96cf"),a("c973")),l=a.n(s),c=(a("551c"),a("06db"),a("970b")),u=a.n(c),d=a("5bc3"),p=a.n(d),f=a("2b0e"),m=function(){function e(t){u()(this,e),this.limpardados(),t&&this.cloneFrom(t)}return p()(e,[{key:"limpardados",value:function(){var e=l()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.uf=null,this.created_at=null,this.md5file=null,this.filename=null,this.sizebytes=null,delete this.usuario;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"cloneFrom",value:function(){var e=l()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=this,a.limpardados(),t){e.next=4;break}return e.abrupt("return");case 4:"undefined"!==typeof t.uf&&(a.uf=t.uf),"undefined"!==typeof t.created_at&&(a.created_at=t.created_at),"undefined"!==typeof t.md5file&&(a.md5file=t.md5file),"undefined"!==typeof t.filename&&(a.filename=t.filename),"undefined"!==typeof t.sizebytes&&(a.sizebytes=t.sizebytes),"undefined"!==typeof t.usuario&&(a.usuario=t.usuario);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteWithQuestion",value:function(){var e=l()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=this,e.prev=1,e.next=7;break;case 4:return e.prev=4,e.t0=e["catch"](1),e.abrupt("return",{ok:!1,msg:e.t0.message,warning:!1});case 7:return e.abrupt("return",new Promise((function(e){t.$q.dialog({title:"Excluir tabela "+a.uf+"?",message:"Para excluir a tabela digite a sigla do estado "+a.uf,prompt:{model:"",type:"text"},cancel:!0}).onOk(function(){var t=l()(i.a.mark((function t(n){var r;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.toUpperCase()!==a.uf.toUpperCase()){t.next=7;break}return t.next=3,a.delete();case 3:r=t.sent,e(r),t.next=8;break;case 7:e({ok:!1,msg:"Informação inválida",warning:!0});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).onCancel((function(){e({ok:!1})}))})));case 8:case"end":return e.stop()}}),e,this,[[1,4]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"delete",value:function(){var e=l()(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,a={uf:t.uf},e.next=4,f["a"].prototype.$axios.delete("v1/admin/tabelaibpt",{params:a}).then((function(e){var t=e.data,a={ok:!1,msg:""};return t&&(a.msg=t.msg?t.msg:"",t.ok&&(a.ok=!0)),a})).catch((function(e){return f["a"].prototype.$helpers.errorReturn(e)}));case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"download",value:function(){var e=l()(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=this,n=f["a"].prototype.$configini.API_URL+"v1/admin/tabelaibpt/download/"+a.uf,t.$helpers.forceFileDownload(n);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),h=m,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-dialog",{ref:"dialog",attrs:{maximized:e.$q.platform.is.mobile},on:{hide:e.onDialogHide}},[a("q-card",{staticClass:"q-dialog-plugin",class:e.$q.platform.is.mobile?"":"full-90"},[a("q-toolbar",{staticClass:"bg-primary text-white"},[a("q-toolbar-title",[e._v("Nova tabela do IBPT")]),a("q-space"),a("q-btn",{attrs:{dense:"",flat:"",icon:"close"},on:{click:e.actClose}},[a("q-tooltip",[e._v("Sair sem salvar (ESC)")])],1)],1),a("q-card-section",[a("div",{staticClass:"col-sm-12"},[a("q-card",{staticClass:"bg-white",attrs:{flat:"",bordered:!e.$q.platform.is.mobile,square:e.$q.platform.is.mobile}},[a("q-card-section",[a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-sm-12 col-md-4"},[a("div",{staticClass:"col-sm-12 col-md-8 col-lg-6"},[e._v("\n                "+e._s(e.uf)+"\n                "),a("q-select",{staticClass:"q-mr-xs",attrs:{options:e.uflista,label:"UF",outlined:"","emit-value":"","stack-label":""},model:{value:e.uf,callback:function(t){e.uf=t},expression:"uf"}})],1)]),a("div",{staticClass:"col-sm-12 col-md-4"},[a("div",{staticClass:"col-sm-12 col-md-8 col-lg-6"},[e._v("\n                "+e._s(e.semestre)+"\n                "),a("q-select",{staticClass:"q-mr-xs",attrs:{label:"UF",outlined:"","emit-value":"","stack-label":"","option-value":"numero","option-label":"nome","map-options":"",options:[{numero:1,nome:"1º Semestre"},{numero:2,nome:"2º Semestre"}]},model:{value:e.semestre,callback:function(t){e.semestre=t},expression:"semestre"}})],1)]),a("div",{staticClass:"col-sm-12 col-md-4"},[a("div",{staticClass:"col-sm-12 col-md-8 col-lg-6"},[e._v("\n                "+e._s(e.ano)+"\n                "),a("q-select",{staticClass:"q-mr-xs",attrs:{label:"Ano",outlined:"","emit-value":"","stack-label":"",options:e.anos},model:{value:e.ano,callback:function(t){e.ano=t},expression:"ano"}})],1)]),a("div",{staticClass:"col-sm-12"},[a("div",{staticClass:"col-12 "},[e._v("\n                "+e._s(e.file)+"\n              ")]),a("div",{staticClass:"col-sm-12"},[a("q-file",{attrs:{clearable:"",outlined:"",label:"Anexar arquivo",counter:"",accept:".csv","max-file-size":"10485760"},on:{rejected:e.onRejected},scopedSlots:e._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"attach_file"}})]},proxy:!0},{key:"hint",fn:function(){return[e._v("\n                    Anexe o arquivo CSV - Limite de 10Mb por arquivo\n                  ")]},proxy:!0}]),model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1)])])]),a("q-card-section",[a("div",{staticClass:"row"},[a("q-btn",{attrs:{unelevated:"",label:"Adicionar",color:"primary",icon:"search",loading:e.loading},on:{click:e.actSalvar}}),a("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",label:"Sair",color:"primary",icon:"close"},on:{click:e.actClose}})],1)])],1)],1)])],1)],1)},b=[],g=a("c1df"),w=a.n(g),k={name:"tabelaibpt.add.dialog",components:{},props:["dataset"],data:function(){return{rows:[],semestre:null,uf:null,ano:null,file:null,title:"Carregando...",loading:!0,tevealteracao:!1,anos:[],uflista:["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"]}},mounted:function(){var e=this;return l()(i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(a=e,n=w()().year(),a.anos=[],r=n-1;r<=n+2;r++)a.anos.push(r);case 4:case"end":return t.stop()}}),t)})))()},methods:{onRejected:function(e){this.$q.notify({type:"negative",message:"".concat(e.length," arquivo não foi carregado devido a restrição de tamanho ou extensão")})},actSalvar:function(){var e=this;return l()(i.a.mark((function t(){var a,n,r,o,s;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,a.loading=!0,n={ok:!1},t.prev=3,r=new z,t.next=7,r.upload(a.file,a.uf,a.semestre,a.ano);case 7:if(n=t.sent,n.ok){t.next=14;break}return o=a.$helpers.showDialog(n),t.next=12,o.then((function(){}));case 12:t.next=14;break;case 14:t.next=23;break;case 16:return t.prev=16,t.t0=t["catch"](3),a.loading=!1,s=a.$helpers.showDialog({ok:!1,msg:t.t0.message}),t.next=22,s.then((function(){}));case 22:return t.abrupt("return",!1);case 23:return t.prev=23,a.loading=!1,t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[3,16,23,26]])})))()},setTitle:function(e){this.title=e},ontevealteracao:function(e){this.tevealteracao=e},actClose:function(){this.onClose(this.tevealteracao)},onClose:function(e){this.$emit("ok",e),this.hide()},actUpdated:function(e){return l()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},show:function(){var e=this;this.$refs.dialog.show(),setTimeout((function(){e.loading=!1}),500)},hide:function(){this.$refs.dialog.hide()},onDialogHide:function(){this.$emit("hide")},onOKClick:function(){this.$emit("ok",!0),this.hide()}}},q=k,x=a("2877"),y=a("24e8"),$=a("f09f"),C=a("65c6"),_=a("6ac5"),P=a("2c91"),Q=a("9c40"),S=a("05c0"),T=a("a370"),D=a("ddd8"),A=a("7d53"),R=a("0016"),B=a("eebe"),E=a.n(B),I=Object(x["a"])(q,v,b,!1,null,null,null),F=I.exports;E()(I,"components",{QDialog:y["a"],QCard:$["a"],QToolbar:C["a"],QToolbarTitle:_["a"],QSpace:P["a"],QBtn:Q["a"],QTooltip:S["a"],QCardSection:T["a"],QSelect:D["a"],QFile:A["a"],QIcon:R["a"]});var O=function(){function e(){u()(this,e),this.limpardados(),this.pagination={page:1,rowsPerPage:15,sortBy:"dhcoleta",descending:!0,rowsNumber:0}}return p()(e,[{key:"limpardados",value:function(){var e=l()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.itens=null;case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"readPropsTable",value:function(e){if(e){var t=e.pagination,a=t.page,n=t.rowsPerPage,r=t.sortBy,o=t.descending,i=t.rowsNumber,s=e.filter;this.filter!==s&&(this.page=1),this.pagination={page:a,rowsPerPage:n,sortBy:r,descending:o,rowsNumber:i},this.filter=s}}},{key:"loadmore",value:function(){var e=l()(i.a.mark((function e(){var t;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.pagination.page=parseInt(this.pagination.page)+1,e.next=3,this.fetch(!0);case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"fetch",value:function(){var e=l()(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,a={},t.itens=[],e.next=5,f["a"].prototype.$axios.get("v1/admin/tabelaibpt",{params:a}).then((function(e){var a=e.data,n={ok:!1,msg:""};if(a&&(n.msg=a.msg?a.msg:"",a.ok&&(a=a.data,t.total=a.total?parseInt(a.total):0,t.pagination.page=a.current_page,t.pagination.rowsPerPage=parseInt(a.per_page),t.pagination.sortBy=a.sortby?a.sortby:"",t.pagination.descending="desc"===a.descending,t.pagination.rowsNumber=a.total?parseInt(a.total):0,n.ok=!0,t.itens=[],a.rows)))for(var r=0;r<a.rows.length;r++){var o=a.rows[r],i=new h(o);t.itens.push(i)}return n})).catch((function(e){return f["a"].prototype.$helpers.errorReturn(e)}));case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"upload",value:function(){var e=l()(i.a.mark((function e(t,a,n,r){var o,s,c;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=new FormData,o.append("uf",a),o.append("semestre",n),o.append("ano",r),o.append("arquivo",t),s=f["a"].prototype.$axios,s.defaults.headers.common["Content-Type"]="multipart/form-data",e.next=9,s.post("v1/admin/tabelaibpt/upload",o).then(function(){var e=l()(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.data,n={ok:!1,msg:""},a&&(n.msg=a.msg?a.msg:"",n.ok=!!a.ok&&a.ok),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return f["a"].prototype.$helpers.errorReturn(e)}));case 9:return c=e.sent,e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)})));function t(t,a,n,r){return e.apply(this,arguments)}return t}()},{key:"showAdd",value:function(){var e=l()(i.a.mark((function e(t){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.$q.dialog({parent:t,component:F,cancel:!0}).onOk(function(){var t=l()(i.a.mark((function t(a){return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e({ok:!0,dados:a});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).onCancel((function(){e(null)}))})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),z=O,M={name:"tabelaibpt.index",components:{},data:function(){var e=new z;return{dataset:e,rows:[],columns:[{name:"action",align:"left",field:"uf",sort:!1},{name:"uf",align:"left",label:"UF",field:"uf",sort:!0},{name:"filename",align:"left",label:"Nome do arquivo",field:"filename",sort:!0},{name:"created_at",align:"left",label:"Criado em",field:"created_at",sort:!0}],loading:!1,posting:!1,error:null,customcnpj:null,customnumero:null,customchave:null}},created:function(){this.$eventbus.$on("coletasconsultaupdated",this.coletasconsultaupdated)},beforeDestroy:function(){this.$eventbus.$off("coletasconsultaupdated",this.coletasconsultaupdated)},computed:{usuariologado:function(){var e=this,t=null;return e.$store.state.usuario.logado&&e.$store.state.usuario.usuario&&(t=e.$store.state.usuario.usuario),t}},mounted:function(){var e=this;return l()(i.a.mark((function t(){var a;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,t.next=3,a.refreshData(null);case 3:case"end":return t.stop()}}),t)})))()},methods:{actAdd:function(){var e=this;return l()(i.a.mark((function t(){var a,n;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e,n=a.dataset.showAdd(a),n.ok&&a.refreshData(null);case 3:case"end":return t.stop()}}),t)})))()},actEditDialog:function(e){var t=this;return l()(i.a.mark((function a(){var n,r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=t,r=n.rows[e],n.$q.bottomSheet({message:"Tabela: "+r.uf,grid:!1,actions:[{label:"Excluir",icon:"delete_forever",color:"red",id:"delete"},{label:"Download",icon:"download_for_offline",id:"download"}]}).onOk(function(){var e=l()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("delete"!==t.id){e.next=5;break}return e.next=3,r.deleteWithQuestion(n);case 3:a=e.sent,a.ok?n.refreshData(null):n.$helpers.showDialog(a);case 5:"download"===t.id&&r.download(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return a.stop()}}),a)})))()},refreshData:function(e){var t=this;return l()(i.a.mark((function a(){var n,r,o;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t,a.prev=1,n.loading=!0,n.error=null,n.error=null,n.dataset.readPropsTable(e),a.next=8,n.dataset.fetch();case 8:if(r=a.sent,!r.ok){a.next=13;break}n.rows=n.dataset.itens,a.next=16;break;case 13:return o=n.$helpers.showDialog(r),a.next=16,o.then((function(){}));case 16:a.next=22;break;case 18:a.prev=18,a.t0=a["catch"](1),n.loading=!1,n.error=a.t0.message;case 22:n.loading=!1;case 23:case"end":return a.stop()}}),a,null,[[1,18]])})))()}}},N=M,U=a("9989"),j=a("54e1"),J=a("eb85"),L=a("eaac"),G=a("db86"),H=a("de5e"),W=Object(x["a"])(N,n,r,!1,null,null,null);t["default"]=W.exports;E()(W,"components",{QPage:U["a"],QBanner:j["a"],QCard:$["a"],QSeparator:J["a"],QCardSection:T["a"],QTable:L["a"],QTd:G["a"],QBtn:Q["a"],QTooltip:S["a"],QPageSticky:H["a"],QToolbar:C["a"],QToolbarTitle:_["a"]})}}]);