(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{2682:function(t,e,a){"use strict";var n=a("d06b"),s=a.n(n);s.a},"91d9":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-layout",{staticClass:"bg-grey-1",attrs:{view:"hHh lpR lff"}},[n("q-header",{staticClass:"bg-primary q-mb-md gradientToolbar"},[n("div",{staticClass:"full-width row justify-center ",class:t.$q.platform.is.mobile?"":"full-height items-center"},[n("div",{staticClass:"column col-xs-12 col-sm-11 col-lg-8 col-xl-8 bg-white"},[n("div",{staticClass:"row full-width"},[n("q-toolbar",{class:t.$q.platform.is.mobile?"bg-primary text-white":"text-black"},[n("q-toolbar-title",{staticClass:"row items-center no-wrap cursor-pointer",attrs:{shrink:""}},[t.$q.platform.is.mobile?n("img",{staticStyle:{"max-height":"40px"},attrs:{src:a("2497")}}):t._e(),t.$q.platform.is.mobile?t._e():n("img",{staticStyle:{"max-height":"30px"},attrs:{src:a("2497")}})]),t.$q.platform.is.mobile?t._e():n("q-separator",{attrs:{spaced:"",inset:"",vertical:""}}),t.$q.platform.is.mobile?t._e():n("q-toolbar-title",[t._v("\n              Coletas sem arquivo XML (NF-e)\n            ")]),n("q-space")],1),t.$q.platform.is.mobile?n("q-toolbar",{staticClass:"bg-deep-orange-8 text-white"},[n("q-toolbar-title",{staticClass:"text-center text-subtitle2 full-width",attrs:{shrink:""}},[t._v("\n              Coletas sem arquivo XML (NF-e)\n            ")]),n("q-space")],1):t._e()],1)])])]),n("q-page-container",{staticClass:"bg-primary"},[n("q-page",{},[n("div",{staticClass:"full-width row justify-center ",class:t.$q.platform.is.mobile?"":"full-height items-center"},[n("div",{staticClass:"column col-xs-12 col-sm-11 col-lg-8 col-xl-8 bg-white",staticStyle:{"border-radius":"0 0 12px 12px"}},[n("div",{staticClass:"row full-width "},[n("q-card",{staticClass:"full-width q-pa-none",attrs:{flat:"",bordered:""}},[t.loading||t.error||!t.xmls.consultado?t._e():n("q-card-section",{staticClass:"q-pa-none"},[n("q-toolbar",{staticClass:"bg-grey-3 text-grey-9"},[n("q-toolbar-title",{staticClass:"text-body2"},[n("div",{staticClass:"text-weight-bold"},[t._v(t._s(t.xmls.cliente.razaosocial))]),n("div",[t._v("CNPJ: "+t._s(t.$helpers.mascaraDocCPFCNPJ(t.xmls.cliente.cnpj)))])]),n("q-space"),n("q-toolbar-title",{staticClass:"text-body2 text-right"},[n("div",{staticClass:"text-weight-bold"},[t._v(t._s(t.xmls.notas?t.xmls.notas.length-t.countSucesso+" nota(s)":""))])])],1)],1),t.loading?n("q-card-section",{staticClass:"q-pa-xl text-center"},[n("q-spinner",{attrs:{color:"primary",size:"3rem",thickness:5}})],1):t._e(),!t.loading&&t.error?n("q-card-section",{staticClass:"q-pa-lg"},[n("div",{staticClass:"bg-red-1 text-red-10 rounded-borders text-center q-pa-md col-"},[n("div",[n("q-icon",{staticClass:"q-ma-md",attrs:{name:"error",size:"60px"}})],1),n("div",{staticClass:"text-h4"},[t._v("Ops!")]),n("div",{staticClass:"text-h6"},[t._v(t._s(t.error))])])]):t._e(),t.loading||t.error||t.xmls.notas&&0!==t.xmls.notas.length||!t.xmls.consultado?t._e():n("q-card-section",{staticClass:"q-pa-lg "},[n("div",{staticClass:"bg-green-1 text-green rounded-borders text-center q-pa-md col-"},[n("div",[n("q-icon",{staticClass:"q-ma-md",attrs:{name:"check_circle",size:"60px"}})],1),n("div",{staticClass:"text-h4"},[t._v("Tudo certo!")]),n("div",{staticClass:"text-h6"},[t._v("Nenhuma nota pendente!!")])])]),!t.loading&&!t.error&&t.xmls.notas&&t.xmls.notas.length>0?n("q-card-section",{staticClass:"q-pa-none"},[n("q-list",{attrs:{separator:""}},t._l(t.xmls.notas,(function(e){return n("q-item",{key:e.notachave,staticClass:"q-my-sm"},[n("input",{ref:"file_"+e.notachave,refInFor:!0,attrs:{type:"file",accept:"text/xml",hidden:""},on:{change:function(a){return t.loadFile(a,e)}}}),n("q-item-section",[n("q-item-label",{staticClass:"text-h6"},[t._v("NF-e: "+t._s(e.notanumero)+" - Série: "+t._s(t.$helpers.padLeftZero(e.notaserie,3)))]),n("q-item-label",{attrs:{lines:"1"}},[t._v("Chave: "+t._s(t.$helpers.mascaraChaveNFe(e.notachave)))]),n("q-item-label",{attrs:{caption:""}},[t._v("Postado "+t._s(t.$helpers.datetimeRelativeToday(e.dhultimo)))]),e.file?n("q-item-label",{staticClass:"text-blue-10 text-weight-bold",attrs:{lines:"1"}},[n("div",{staticClass:"q-pa-md q-mt-md rounded-borders bg-grey-3"},[n("div",[t._v("Arquivo: "+t._s(e.file.name))]),n("div",[t._v("Tamanho: "+t._s(t.$helpers.bytesToHumanFileSizeString(e.file.size)))])])]):t._e(),e.filesending||e.fileret?n("q-item-label",{staticClass:"text-blue-10 text-weight-bold",attrs:{lines:"1"}},[e.filesending?n("div",{staticClass:"a-mt-sm"},[n("div",[n("q-linear-progress",{staticClass:"q-mt-sm",attrs:{indeterminate:"",rounded:"",color:"blue-10","track-color":"white",size:"12px"}})],1),n("div",{staticClass:"q-pa-sm text-center full-width"},[t._v("Enviando arquivo...")])]):t._e(),e.fileret?n("div",{staticClass:"q-mt-sm"},[e.fileret.ok?n("q-banner",{staticClass:"bg-positive text-white rounded-borders"},[n("q-icon",{staticClass:"q-mr-sm",attrs:{name:"check_circle",size:"20px"}}),t._v(" Arquivo enviado com sucesso!\n                        ")],1):t._e(),e.fileret.ok?t._e():n("q-banner",{staticClass:"bg-negative text-white rounded-borders",scopedSlots:t._u([{key:"action",fn:function(){return[n("q-btn",{attrs:{flat:"",color:"white",label:"Tentar novamente"},on:{click:function(a){return t.actInputFile(e)}}}),n("q-btn",{attrs:{flat:"",color:"white",label:"Reiniciar"},on:{click:function(a){return t.actRestart(e)}}})]},proxy:!0}],null,!0)},[n("div",[n("q-icon",{staticClass:"q-mr-sm",attrs:{name:"error",size:"20px"}}),t._v(" Falha ao enviar arquivo!")],1),n("q-separator",{attrs:{spaced:""}}),n("div",{staticClass:"text-caption"},[t._v(t._s(e.fileret.msg))]),n("q-tooltip",{attrs:{delay:500}},[t._v(t._s(e.fileret.msg))])],1)],1):t._e()]):t._e(),e.file||e.fileret?t._e():n("q-item-label",{staticClass:"q-mt-sm",attrs:{lines:"1"}},[n("q-btn-group",{staticClass:"full-width",attrs:{outline:""}},[n("q-btn",{staticClass:"full-width",attrs:{outline:"",color:"grey-9",icon:"file_upload",label:"Enviar arquivo","no-caps":""},on:{click:function(a){return t.actInputFile(e)}}}),n("q-separator",{attrs:{vertical:""}}),n("q-btn",{attrs:{outline:"",icon:"file_copy"},on:{click:function(a){return t.$helpers.copytoclipboard(e.notachave)}}})],1)],1)],1)],1)})),1)],1):t._e(),t.xmls.consultado||t.loading?t._e():n("q-card-section",{staticClass:"text-center q-py-md"},[n("div",{staticClass:"full-width row justify-center items-center"},[t.recaptchaloading?n("div",[t._v("carregando...")]):t._e(),n("vue-recaptcha",{attrs:{sitekey:t.$configini.RECAPTCHA_KEY,loadRecaptchaScript:!0},on:{verify:t.verify,render:t.rendered}})],1)])],1)],1)])])])],1),n("q-footer",[n("div",{staticClass:"bg-grey-2 text-grey-8 text-caption q-pa-xs text-center"},[n("div",[n("span",{staticClass:"text-weight-bold"},[t._v(t._s(t.appPackage.productName)+" :: "+t._s(t.appPackage.description))]),t._v(" | Versão "+t._s(t.appPackage.version)+" release "+t._s(t.$helpers.datetimeToBR(t.appPackage.releasedatetime)))]),n("div",[t._v("© Copyright "+t._s(t.year?t.year:"")+" :: "),n("a",{attrs:{href:"http://www.i12.com.br",target:"_blank"}},[t._v("i12.com.br")])])])])],1)},s=[],i=a("a34a"),r=a.n(i),o=(a("96cf"),a("c973")),l=a.n(o),c=a("bc3a"),u=a.n(c),d=a("e096"),p=a("c1df"),h=a.n(p),m=a("9224"),f=a("970b"),v=a.n(f),g=a("5bc3"),x=a.n(g),b=a("2b0e"),q=function(){function t(e){v()(this,t),this.limpardados(),e&&this.cloneFrom(e)}return x()(t,[{key:"limpardados",value:function(){var t=l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.notanumero=null,this.notaserie=null,this.notachave=null,this.dhultimo=null,this.file=null;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"cloneFrom",value:function(){var t=l()(r.a.mark((function t(e){var a;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=this,a.limpardados(),e){t.next=4;break}return t.abrupt("return");case 4:"undefined"!==typeof e.notanumero&&(this.notanumero=e.notanumero),"undefined"!==typeof e.notaserie&&(this.notaserie=e.notaserie),"undefined"!==typeof e.notachave&&(this.notachave=e.notachave),"undefined"!==typeof e.dhultimo&&(this.dhultimo=e.dhultimo);case 8:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}]),t}(),w=q,C=function(){function t(){v()(this,t),this.limpardados()}return x()(t,[{key:"limpardados",value:function(){var t=l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.consultado=!1,this.cliente=null,this.notas=null,this.accesscode=null;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"fetch",value:function(){var t=l()(r.a.mark((function t(e,a){var n,s,i,o;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this,n.limpardados(),s={token:e,"g-recaptcha-response":a},i=u.a.create({baseURL:b["a"].prototype.$configini.API_URL,withCredentials:!1,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Authorization","Access-Control-Allow-Methods":"GET, POST, OPTIONS, PUT, PATCH, DELETE","Content-Type":"application/json;charset=UTF-8"}}),t.next=6,i.get("/v1/publico/notas/xmlpendente",{params:s}).then((function(t){var e=t.data,a={ok:!1,msg:""};if(e&&(a.msg=e.msg?e.msg:"",e.ok&&(e=e.data,n.cliente=e.cliente?e.cliente:null,n.accesscode=e.accesscode?e.accesscode:null,n.notas=[],e.notas)))for(var s=0;s<e.notas.length;s++){var i=e.notas[s],r=new w(i);r.notanumero>0&&n.notas.push(r)}return n.consultado=!0,a})).catch((function(t){return b["a"].prototype.$helpers.errorReturn(t)}));case 6:return o=t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}()}]),t}(),_=C,k={name:"publico.coleta.xmlpendente",components:{VueRecaptcha:d["a"]},data:function(){var t=new _;return{title:"Conecta Transportes - Envio de arquivo XML",xmls:t,token:null,recaptchaloading:!0,recaptchatoken:null,loading:!1,error:null,appPackage:m,year:2021,testeerro:!1}},meta:function(){return{title:this.title}},mounted:function(){var t=this;t.year=h()().year(),t.$route.query.token&&(t.token=t.$route.query.token),t.recaptchaLoad()},computed:{countSucesso:function(){var t=this,e=0;try{if(t.loading)throw new Error("Em loading");if(t.xmls.notas&&0===t.xmls.notas.length)throw new Error("Nenhum nota");for(var a=0;a<t.xmls.notas.length;a++){var n=t.xmls.notas[a];n.fileret&&n.fileret.ok&&(e+=1)}}catch(s){e=0}return e}},methods:{rendered:function(t){this.recaptchaloading=!1},verify:function(t){var e=this;return l()(r.a.mark((function a(){return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.recaptchatoken=t,e.recaptchatoken&&e.init();case 2:case"end":return a.stop()}}),a)})))()},recaptchaLoad:function(){return l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},actRestart:function(t){var e=this;e.$nextTick((function(){e.loading=!0,delete t.fileret,delete t.file,t.filesending=!1,e.loading=!1}))},actInputFile:function(t){var e=this;try{if(t.filesending)throw new Error("Enviando");if(t.fileret&&t.fileret.ok)throw new Error("Arquivo já foi enviando")}catch(n){return void console.error(n)}var a=e.$refs["file_"+t.notachave][0];a.click()},loadFile:function(t,e){var a=this,n=t.target.files;n&&n[0]&&(e.file=n[0],a.sendFile(e))},sendFile:function(t){var e=this;e.$nextTick((function(){e.loading=!0,delete t.fileret,t.filesending=!0,e.loading=!1}));var a=new FormData;a.append("file",t.file),a.append("notachave",t.notachave),a.append("token",e.token),a.append("accesscode",e.xmls.accesscode);var n=u.a.create({baseURL:e.$configini.API_URL,withCredentials:!1,headers:{"x-auth-uuid":e.$store.state.usuario.uuid,"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Authorization","Access-Control-Allow-Methods":"GET, POST, OPTIONS, PUT, PATCH, DELETE","Content-Type":"application/json;charset=UTF-8"}});n.defaults.headers.common["Content-Type"]="multipart/form-data",n.post("/v1/publico/notas/"+e.xmls.cliente.cnpj+"/xmlpendente/envio",a).then((function(a){var n=a.data,s={ok:!1,msg:""};return n&&(s.msg=n.msg?n.msg:"",n.ok&&(s.ok=!0)),e.$nextTick((function(){e.loading=!0,delete t.file,delete t.filesending,t.fileret={ok:!!n&&n.ok,msg:n.msg?n.msg:""},e.loading=!1,t.fileret.ok&&setTimeout((function(){e.countSucesso===e.xmls.notas.length&&e.fimEnvio()}),300)})),s})).catch((function(a){e.$nextTick((function(){e.loading=!0,delete t.file,delete t.filesending,t.fileret={ok:!1,msg:a.message},console.error(a),e.loading=!1}))}))},fimEnvio:function(){var t=this;return l()(r.a.mark((function e(){var a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t,a.xmls.notas=null;case 2:case"end":return e.stop()}}),e)})))()},init:function(){var t=this;return l()(r.a.mark((function e(){var a,n;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,a.loading=!0,a.error=null,e.next=5,a.xmls.fetch(a.token,a.recaptchatoken);case 5:n=e.sent,n.ok||(a.error=n.msg&&""!==n.msg?n.msg:null),a.loading=!1;case 8:case"end":return e.stop()}}),e)})))()}}},y=k,T=(a("2682"),a("2877")),$=a("4d5a"),A=a("e359"),P=a("65c6"),E=a("6ac5"),Q=a("eb85"),F=a("2c91"),S=a("09e3"),L=a("9989"),R=a("f09f"),I=a("a370"),z=a("0d59"),N=a("0016"),O=a("1c1c"),j=a("66e5"),H=a("4074"),U=a("0170"),M=a("6b1d"),B=a("54e1"),D=a("9c40"),J=a("05c0"),G=a("e7a9"),X=a("7ff0"),V=a("eebe"),K=a.n(V),Y=Object(T["a"])(y,n,s,!1,null,null,null);e["default"]=Y.exports;K()(Y,"components",{QLayout:$["a"],QHeader:A["a"],QToolbar:P["a"],QToolbarTitle:E["a"],QSeparator:Q["a"],QSpace:F["a"],QPageContainer:S["a"],QPage:L["a"],QCard:R["a"],QCardSection:I["a"],QSpinner:z["a"],QIcon:N["a"],QList:O["a"],QItem:j["a"],QItemSection:H["a"],QItemLabel:U["a"],QLinearProgress:M["a"],QBanner:B["a"],QBtn:D["a"],QTooltip:J["a"],QBtnGroup:G["a"],QFooter:X["a"]})},d06b:function(t,e,a){}}]);